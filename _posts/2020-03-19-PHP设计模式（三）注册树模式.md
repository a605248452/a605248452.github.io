---
layout: post
title: php 设计模式（三）注册树模式
date: 2020-3-19
tags: 设计模式
---

### 什么是注册树模式

**注册树模式通过将对象实例注册到全局对象树上，需要的时候将对象从全局对象树上取下来**，就像小时候买糖葫芦一样，卖糖葫芦的将糖葫芦插到一个大的杆子上，人们买的时候就取下来，不同的是，注册树模式摘下来还会有，能摘很多次，糖葫芦摘一次就没了。

### 为什么要使用注册树模式

前面说到的单例模式解决了在整个项目中创建唯一对象的问题，

工厂模式解决了不通过new解决实例对象的问题，考虑的是项目拓展与维护。

总得来说单例模式和工厂模式可以产生更加合理的对象，

那怎么方便统筹调用这些对象呢，这时候就用到了注册树模式，**不管你是单例模式，工厂模式还是二者结合生成的对象，都给我统统注册到树上，用到某个对象的时候，直接从树上取下来就好**。

### 如何实现注册树

我们用“四个一”来记

(1).**一个静态变量**，用于将所有的对象**插入到注册树上**，而且这个注册树应该是一个二位数组。

(2).**一个插入对象实例的方法**（set()）。

(3).**一个撤销对象实例的方法**（__unset()）。

(4).**一个获取对象实例的方法**（get()）。

拥有这些，我们就可以愉快的完成注册树模式了。

### 代码示例

```php
<?php

/**
 * Class MysqlFactory 工厂类
 */
class MySQLFactory
{
    public static function factory($className){
        return new $className;
    }
}

/**
 * Interface Mysql MySQL约束接口
 */
interface MySQL {
    public function connect();
}


/**
 * Class Mysqli mysqli连接 实现方式
 */
class Mysqli implements MySQL
{
    public function connect()
    {
        echo 'mysqli is connected';
    }
}

/**
 * Class PDO PDO连接 实现方式
 */
class PDO implements MySQL
{
    public function connect()
    {
        echo 'PDO is connected';
    }
}

/**
 * @purpose: 创建一个注册树模式
 * Class Register
 */
class Register
{
    /**
     * @var array 将所有的对象“插入”到注册树上
     */
    static protected $objects;

    public static function set($alias, $object)
    {
        self::$objects[$alias] = $object;
    }

    public static function __unset($alias)
    {
        unset(self::$objects[$alias]);
    }

    public static function get($alias)
    {
        return self::$objects[$alias];
    }
}

Register::set('SingleMysqlPDO', MySQLFactory::factory('PDO'));

$single = Register::get('SingleMysqlPDO');

```