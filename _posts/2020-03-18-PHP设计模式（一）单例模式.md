---
layout: post
title: php 设计模式
date: 2015-8-17
tags: 设计模式
---

定义：简单来说，整个应用中只有一个实例对象的设计模式被称之为单例模式

### 单例模式的要点

构造函数需要外部不可访问，一般来说标记为 private （防止外部代码使用 new 操作符创建对象），单例类不能在其他类中实例化，只能被其自身实例化；

拥有一个保存类的实例的静态变量

拥有一个访问这个实例的公共静态方法 （常用 getInstance() 方法进行实例化单例类，通过instanceof 操作符可以检测到类是否已被实例化）

##### 简单的记为三私一公

(1).私有的静态属性（private static $instance），用来储存生成的唯一对象

(2).私有的构造函数（private function __construct()）

(3).私有的克隆函数（private function __clone()），防止外部克隆唯一对象

(4).公共的静态方法（public static function getInstance()），用来访问静态属性储存的对象，如果没有对象，则生成此单例

(5).关键字 instanceof，检查次变量是否为该类的对象，子类，或者是实现接口。

### 为什么要使用单例模式

php的应用主要在于数据库应用，所以一个应用中会存在大量的数据库操作，使用单例模式，则可以避免大量的 new 操作消耗的资源。

如果一个系统中需要有一个类来全局控制某些配置信息，那么使用单例模式会很方便的实现

在一次页面请求中，为了便于进行调试，因为所有的代码（例如数据库操作类DB）都集中在一个类中，我们可以**在类中设置钩子，输出日志**，从而避免到处 var_dump echo。

### 单例模式解决的问题

单例模式解决的是**如何在整个项目中创建唯一的对象实例**的问题，单例模式和工厂模式可以产生更加合理的对象。

```php
<?php

/**
 * 创建一个单例类
 * Class single
 */
class Single
{
    /**
     * @var Object 保存类实例的静态成员变量
     */
    static private $instance;

    /**
     * Single constructor. 私有的构造方法
     */
    private function __construct(){}

    /**
     * @return Object|Single 单例方法，用于访问实例的公共的静态方法
     */
    public static function getInstance()
    {
        if (! self::$instance instanceof self) {
            self::$instance = new self();
        }
        return self::$instance;
    }

    /**
     * @purpose: 创建__clone方法防止对象被复制克隆
     */
    private function __clone(){}
}
```